<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
	  xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
	  xmlns:publish="http://typo3.org/ns/In2code/In2publishCore/ViewHelpers"
	  data-namespace-typo3-fluid="true"
>
	<f:if condition="{record}">
		<tr class="in2publish-stagelisting__item in2publish-stagelisting__item--{record.stateRecursive}"
			data-searchable="{publish:miscellaneous.getPropertyFromStagingDefinition(propertyName: 'name', record: record, stagingLevel: 'local')}|{publish:miscellaneous.getPropertyFromStagingDefinition(propertyName: 'name', record: record, stagingLevel: 'foreign')}">
			<f:comment>Left</f:comment>
			<td class="col-icon">
				<f:if condition="{record.localProperties.uid}">
					<span data-bs-toggle="tooltip" title="uid={record.localProperties.uid}">
						<core:iconForResource resource="{publish:miscellaneous.getFileResourceByUid(uid: record.localProperties.uid)}"/>
					</span>
				</f:if>
			</td>
			<td class="col-filename col-responsive nowrap">
				<f:if condition="{config.debug.showRecordDepth}">[{record.additionalProperties.depth}]</f:if>
				<span class="in2publish-stagelisting__item-filename">
					<f:if condition="{record.state} === 'deleted'">
						<f:then>
							<publish:Miscellaneous.GetPropertyFromStagingDefinition record="{record}" propertyName="name" stagingLevel="foreign" />
						</f:then>
						<f:else>
							<publish:Miscellaneous.GetPropertyFromStagingDefinition record="{record}" propertyName="name" stagingLevel="local" />
						</f:else>
					</f:if>
				</span>
			</td>
			<td class="col-control">
				<div class="btn-group">
					<a class="btn btn-default" data-bs-toggle="collapse" href="#{record.tableName}-{record.localProperties.uid}">
						<core:icon identifier="actions-info" />
					</a>
					<f:if condition="{record.state} != 'deleted'">
						<f:then>
							<f:link.external
								class="btn btn-default"
								uri="{publish:File.BuildResourcePath(record:record,stagingLevel:'local')}"
								additionalAttributes="{'data-bs-toggle': 'tooltip'}"
								title="{f:translate(key: 'LLL:EXT:core/Resources/Private/Language/locallang_common.xlf:view')}"
								target="_blank">
								<core:icon identifier="actions-eye" />
							</f:link.external>
						</f:then>
					</f:if>
					<f:if condition="{record.relatedRecords.sys_file_metadata}">
						<f:then>
							<f:for each="{record.relatedRecords.sys_file_metadata}" as="metaRecord" iteration="iterator">
								<f:if condition="{iterator.isFirst}">
									<a class="btn btn-default" href="{publish:uri.editUri(uid: metaRecord.localProperties.uid, tableName: metaRecord.tableName)}" data-bs-toggle="tooltip" title="{f:translate(key: 'LLL:EXT:core/Resources/Private/Language/locallang_common.xlf:edit')}">
										<core:icon identifier="actions-pencil" />
									</a>
								</f:if>
							</f:for>
						</f:then>
						<f:else>
							<span class="btn btn-default disabled" aria-hidden="true">
								<core:icon identifier="empty-empty" />
							</span>
						</f:else>
					</f:if>
				</div>
			</td>
			<td></td>
			<td>
				<f:if condition="{record.changedRecursive}">
					<f:link.action
						class="t3js-modal-trigger btn btn-default"
						action="publishFile"
						arguments="{
							uid:record.identifier,
							identifier:'{publish:record.getMergedProperty(record:record, propertyName: \'identifier\')}',
							storage:'{publish:record.getMergedProperty(record:record, propertyName: \'storage\')}'}"
						additionalAttributes="{data-title: '{f:translate(key:\'publish\')}', data-content: '{f:translate(key:\'confirm_publish_file\')}', data-severity: 'warning'}">
						<f:translate key="publish"/>
						<core:icon identifier="actions-arrow-right" />
					</f:link.action>
				</f:if>
			</td>

			<f:comment>Right</f:comment>
			<td class="col-icon">
				<f:if condition="{record.localProperties.uid} && {record.foreignProperties.uid}">
					<span data-bs-toggle="tooltip" title="uid={record.foreignProperties.uid}">
						<core:iconForResource resource="{publish:miscellaneous.getFileResourceByUid(uid: record.localProperties.uid)}"/>
					</span>
				</f:if>
			</td>
			<td class="col-filename col-responsive nowrap">
				<publish:Miscellaneous.GetPropertyFromStagingDefinition record="{record}" propertyName="name" stagingLevel="foreign" />
			</td>
			<td class="col-control">
				<f:if condition="{record.state} != 'added'">
					<f:then>
						<f:link.external
							class="btn btn-default"
							uri="{publish:File.BuildResourcePath(record:record,stagingLevel:'foreign')}"
							additionalAttributes="{'data-bs-toggle': 'tooltip'}"
							title="{f:translate(key: 'LLL:EXT:core/Resources/Private/Language/locallang_common.xlf:view')}"
							target="_blank">
							<core:icon identifier="actions-eye" />
						</f:link.external>
					</f:then>
				</f:if>
			</td>

			<td>
				<i class="in2publish-state-icon in2publish-state--{record.stateRecursive} in2publish-icon-circle ms-2"></i>
				<f:translate key="record.state.{record.stateRecursive}.short"/>
			</td>
		</tr>

		<f:comment>Difference View</f:comment>
		<f:render partial="File/Index/DirtyPropertiesList" arguments="{_all}" />
	</f:if>
</html>
