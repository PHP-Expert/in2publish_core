<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
	  data-namespace-typo3-fluid="true"
>
	<f:layout name="Default"/>

	<f:section name="HeaderNavigationRight">
		<f:comment>Disable default pagePath and pageInfo.</f:comment>
	</f:section>

	<f:section name="Main">
		<f:be.widget.paginate objects="{redirects}" as="paginatedRedirects" configuration="{itemsPerPage: 20, insertAbove: 1, insertBelow: 1, recordsLabel: 'Redirects'}">
			<f:form action="publish">
				<table class="table">
					<thead>
						<tr>
							<th>ID</th>
							<th>Domain</th>
							<th>Source</th>
							<th>Target</th>
							<th>
								<f:if condition="{orderBy.pageUid}">
									<f:then>
										<f:if condition="{orderBy.pageUid} == 'ASC'">
											<f:then>
												<f:link.action action="list" arguments="{orderBy: {pageUid: 'DESC'}}">
													Status <core:icon identifier="actions-caret-down" size="small"/>
												</f:link.action>
											</f:then>
											<f:else>
												<f:link.action action="list" arguments="{orderBy: {pageUid: 'ASC'}}">
													Status <core:icon identifier="actions-caret-up" size="small"/>
												</f:link.action>
											</f:else>
										</f:if>
									</f:then>
									<f:else>
										<f:link.action action="list" arguments="{orderBy: {pageUid: 'ASC'}}">
											Status
										</f:link.action>
									</f:else>
								</f:if>
							</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						<f:for each="{paginatedRedirects}" as="redirect">
							<tr>
								<td>{redirect.uid}</td>
								<td>{redirect.sourceHost}</td>
								<td>{redirect.sourcePath}</td>
								<td>{redirect.target}</td>
								<td>
									<f:switch expression="{redirect.publishingState}">
										<f:case value="publishable">
											<span title="{f:render(partial: 'Redirect/DirtyProperties.txt', arguments: _all)}">
												<core:icon identifier="actions-code-fork" size="small" />
											</span>
										</f:case>
										<f:case value="siteRequired">
											<span title="Missing associated page or site">
												<core:icon identifier="apps-pagetree-page" overlay="overlay-missing" size="small" />
											</span>
										</f:case>
										<f:case value="requiresPagePublishing">
											<span title="The associated page [{redirect.pageUid}] &quot;{redirect.pageTitle}&quot; is not published">
												<core:icon identifier="apps-pagetree-page" overlay="overlay-warning" size="small" />
											</span>
										</f:case>
										<f:case value="unchanged">
											<span title="Published and unchanged">
												<core:icon identifier="actions-check" size="small" />
											</span>
										</f:case>
									</f:switch>
								</td>
								<td>
									<f:link.action action="edit" class="btn btn-default" arguments="{redirect: redirect}" title="Edit">
										<core:icon identifier="actions-open" size="small"/>
									</f:link.action>
									<f:switch expression="{redirect.publishingState}">
										<f:case value="publishable">
											<div class="btn-group">
												<label class="btn btn-default">
													<f:form.checkbox title="Select for bulk publishing" value="{redirect.uid}" style="margin: 0" name="redirects[]"/>
													<f:variable name="viewPublishAll" value="1" />
												</label>
												<f:link.action action="publish" class="btn btn-default" arguments="{redirects: {0: redirect}}" title="Publish">
													<core:icon identifier="actions-caret-right" size="small" />
												</f:link.action>
											</div>
										</f:case>
										<f:case value="siteRequired">
											<f:link.action action="publishCustom" class="btn btn-default" arguments="{redirects: {0: redirect}}" title="Publish">
												<core:icon identifier="actions-caret-right" overlay="overlay-external-link" size="small" />
											</f:link.action>
										</f:case>
									</f:switch>
								</td>
							</tr>
						</f:for>
					</tbody>
					<f:if condition="{viewPublishAll}">
						<tfoot>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
								<td>
									<f:form.submit class="btn btn-default" value="Publish all selected" />
								</td>
							</tr>
						</tfoot>
					</f:if>
				</table>
			</f:form>
		</f:be.widget.paginate>
		<div>
			Status explanation:
			<div>
				<core:icon identifier="apps-pagetree-page" overlay="overlay-missing" size="small" />: The redirect does not have an associated page or site
			</div>
			<div>
				<core:icon identifier="apps-pagetree-page" overlay="overlay-warning" size="small" />: The associated page is not published
			</div>
			<div>
				<core:icon identifier="actions-code-fork" size="small" />: This redirect was changed but not published
			</div>
			<div>
				<core:icon identifier="actions-check" size="small" />: This redirect has no changes and is published
			</div>
			Actions explanation:
			<div>
				<core:icon identifier="actions-caret-right" size="small" />: This redirect can be published
			</div>
			<div>
				<core:icon identifier="actions-caret-right" overlay="overlay-external-link" size="small" />: This redirect can be published with a manual site association
			</div>
		</div>
	</f:section>
</html>
